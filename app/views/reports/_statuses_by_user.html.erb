<%
if params[:filter].blank? || params[:filter][:start_date].blank?
  @start_date = I18n.localize(Time.now.beginning_of_day, format: '%d %b %Y %H:%M')
else
  @start_date = I18n.localize(params[:filter][:start_date].to_time, format: '%d %b %Y %H:%M')
end
if params[:filter].blank? || params[:filter][:stop_date].blank?
  @stop_date = I18n.localize(Time.now.end_of_day, format: '%d %b %Y %H:%M' )
else
  @stop_date = I18n.localize(params[:filter][:stop_date], format: '%d %b %Y %H:%M' )
end
%>

<p>Входящие вызовы за период с <b><%= @start_date %></b> по <b><%= @stop_date %></b>:</p>
<%
  t1 = {}
  @result[0].each do |row|
    t1[[row[:user],row[:status]]] = row[:count]
  end
%>
<table class="table table-striped table-bordered table-hover table-heading no-border-bottom table-responsive">
  <thead class="thead-light">
    <tr>
      <th>Оператор</th>
      <% @result[0].map{|x| x.status}.uniq.each do |s| %>
        <th><%= s %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @result[0].map{|x| x.user}.uniq.each do |u| %>
      <tr>
        <td><%= u %></td>
        <% @result[0].map{|x| x.status}.uniq.each do |s| %>
          <td>
            <%= t1[[u, s]].to_i %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>


<p>Исходящие вызовы за период с <b><%= @start_date %></b> по <b><%= @stop_date %></b>:</p>
<%
  t2 = {}
  @result[1].each do |row|
    t2[[row[:user],row[:status]]] = row[:count]
  end
%>
<table class="table table-striped table-bordered table-hover table-heading no-border-bottom table-responsive">
  <thead class="thead-light">
    <tr>
      <th>Оператор</th>
      <% @result[1].map{|x| x.status}.uniq.each do |s| %>
        <th><%= s %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @result[1].map{|x| x.user}.uniq.each do |u| %>
      <tr>
        <td><%= u %></td>
        <% @result[1].map{|x| x.status}.uniq.each do |s| %>
          <td>
            <%= t2[[u, s]].to_i %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>