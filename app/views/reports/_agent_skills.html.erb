<%
ingroups = {}
VicidialInboundGroup.all.map{|ig| ingroups[ig.group_id] = ig.group_name }
operators = {}
VicidialUser.all.map{|u| operators[u.user] = u.full_name }
%>
<table class="table table-striped table-bordered table-hover table-heading no-border-bottom table-responsive">
  <thead>
    <tr>
      <th rowspan="3">ID оператора (ФИО)</th>
      <th colspan="<%= @result[1].size*2 %>">Входящие линии (направления)</th>
    </tr>
    <tr>
      <% @result[1].each do |ingroup| %>
        <th colspan="2"><%= ingroups[ingroup] %></th>
      <% end %>
    </tr>
    <tr>
        <% @result[1].size.times do %>
          <th>RANK</th>
          <th>GRADE</th>
        <% end %>
    </tr>
  </thead>
  <tbody>
    <% @result[0].each do |agent| %>
      <tr>
          <td><%= agent %> (<%= operators[agent] %>)</td>
          <% @result[1].each do |ingroup| %>
            <td><%= @result[2][agent][ingroup][:rank] %></td>
            <td><%= @result[2][agent][ingroup][:grade] %></td>
          <% end %>
      </tr>
    <% end %>
  </tbody>
</table>