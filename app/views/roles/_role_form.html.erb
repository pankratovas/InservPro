<%= form_for(@role, html: {class: "form-horizontal", role: "form"}, local: true) do |f| %>
  <%= render 'layouts/errors' %>
  <div class="row">
    <div class="col-4">
      <%= f.label "Название роли", class: "form-label" %>
      <%= f.text_field :name, class: "form-control", id: "name" %>
    </div>
    <div class="col-4">
      <%= f.label "Описание роли", class: "form-label" %>
      <%= f.text_field :description, class: "form-control", id: "description" %>
    </div>
    <div class="col-4">
      <%= f.label "Доступно меню 'Управление'", class: "form-label" %>
      <% if @role.permissions.nil? %>
        <%= select_tag "role[permissions][role]", options_for_select([['Да', 'super'],['Нет', 'oper']]), class: "form-control", id: "role_key" %>
      <% else %>
        <%= select_tag "role[permissions][role]", options_for_select([['Да', 'super'],['Нет', 'oper']], @role.permissions["role"]), class: "form-control", id: "role_key" %>
      <% end %>
    </div>
  </div>
  <br>
  <ul class="nav nav-tabs" id="permissionsTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active"
              id="campaigns-tab"
              data-bs-toggle="tab"
              data-bs-target="#campaigns"
              type="button" role="tab"
              aria-controls="campaigns"
              aria-selected="true">
        <h6>Кампании и ингруппы</h6>
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link"
              id="reports-tab"
              data-bs-toggle="tab"
              data-bs-target="#reports"
              type="button"
              role="tab"
              aria-controls="reports"
              aria-selected="false">
        <h6>Отчеты</h6>
      </button>
    </li>
  </ul>
  <div class="tab-content" id="permissionsTabContent">
    <div class="tab-pane fade show active" id="campaigns" role="tabpanel" aria-labelledby="campaigns-tab">
      <br>
      <% VicidialCampaign.all_campaigns.in_groups_of(3, false) do |campaigns| %>
        <div class="row">
          <% campaigns.each do |campaign| %>
            <div class="col-4">
              <% if @role.permissions.nil? %>
                <%= check_box_tag "role[permissions][campaigns][]", campaign.campaign_id %>
              <% else %>
                <%= check_box_tag "role[permissions][campaigns][]", campaign.campaign_id, @role.permissions["campaigns"].present? ? @role.permissions["campaigns"].include?(campaign.campaign_id) : nil %>
              <% end %>
              <a class="btn btn-outline-secondary"
                 data-bs-toggle="collapse"
                 href="#collapseCampaign_<%= campaign.campaign_id %>"
                 role="button"
                 aria-expanded="false"
                 aria-controls="collapseCampaign_<%= campaign.campaign_id %>">
                <%= campaign.campaign_name %>
              </a>
              <div class="collapse" id="collapseCampaign_<%= campaign.campaign_id %>">
                <div class="card card-body">
                  <% for ingroup in campaign.ingroups %>
                    <ul>
                      <li class="list-unstyled">
                        <% if @role.permissions.nil? %>
                          <%= check_box_tag "role[permissions][ingroups][]", ingroup.group_id %>
                        <% else %>
                          <%= check_box_tag "role[permissions][ingroups][]", ingroup.group_id, @role.permissions["ingroups"].present? ? @role.permissions["ingroups"].include?(ingroup.group_id) : nil %>
                        <% end %>
                        <%= ingroup.group_name %>
                      </li>
                    </ul>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
        <br>
      <% end %>
    </div>
    <div class="tab-pane fade" id="reports" role="tabpanel" aria-labelledby="reports-tab">
      <br>
      <% for report in Report.where(activated: true) %>
        <ul>
          <li class="list-unstyled">
            <% if @role.permissions.nil? %>
              <%= check_box_tag "role[permissions][reports][]", report.id %>
            <% else %>
              <%= check_box_tag "role[permissions][reports][]", report.id, @role.permissions["reports"].present? ? @role.permissions["reports"].include?(report.id.to_s) : nil %>
            <% end %>

            <%= report.description %>
          </li>
        </ul>
      <% end %>
    </div>
  </div>
  <br>
  <div class="text-center">
    <%= link_to('Отмена', roles_path, class: "btn btn-warning btn-label-left") %>
    <%= button_tag('Сохранить', type: 'submit', class: "btn btn-primary btn-label-left") %>
  </div>
<% end %>